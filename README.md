# Heat Mem â€“ çƒ­åŠ›è®°å¿†ç³»ç»Ÿ

**Heat Mem** æ˜¯ä¸€ä¸ªä¸º AI å¯¹è¯ç³»ç»Ÿè®¾è®¡çš„é•¿æœŸè®°å¿†æ¨¡å—ï¼Œé€šè¿‡**çƒ­åŠ›å€¼**åŠ¨æ€ç®¡ç†è®°å¿†çš„é‡è¦æ€§ï¼Œå¹¶ç»“åˆ**è¯­ä¹‰èšç±»**ä¸**è”æƒ³å›¾ï¼ˆWaypointï¼‰** æŠ€æœ¯ï¼Œè®© AI èƒ½å¤Ÿé«˜æ•ˆåœ°å­˜å‚¨ã€æ£€ç´¢å’Œè”æƒ³å†å²å¯¹è¯ã€‚

é»˜è®¤**main.py**æ­è½½äº†ä¸€ä¸ªåä¸ºmoriçš„agentã€‚æ²¡åˆ«çš„æ„æ€ï¼Œå•çº¯æé†’ä½ å†çœŸå®ï¼Œå®ƒä¹Ÿæ˜¯æ­»çš„ã€‚

è¿™ä¸ªreadmeç”±deepseekç”Ÿæˆï¼Œæˆ‘æ‰¿è®¤æˆ‘æ‡’å¾—å†™ã€‚

---

## âœ¨ æ ¸å¿ƒç‰¹æ€§

- **ğŸ”¥ çƒ­åŠ›é©±åŠ¨çš„è®°å¿†ç”Ÿå‘½å‘¨æœŸ**  
  æ¯ä¸ªè®°å¿†å’Œè¯­ä¹‰ç°‡éƒ½æ‹¥æœ‰çƒ­åŠ›å€¼ï¼Œç³»ç»Ÿé€šè¿‡å…¨å±€çƒ­åŠ›æ± è‡ªåŠ¨åˆ†é…ã€å›æ”¶å’Œè°ƒèŠ‚çƒ­åŠ›ï¼Œä½¿é‡è¦è®°å¿†ä¿æŒæ´»è·ƒï¼Œå†·é—¨è®°å¿†è‡ªç„¶æ²‰é™ï¼Œå®ç°é•¿æœŸè®°å¿†çš„è‡ªåŠ¨ç®¡ç†ã€‚

- **ğŸ§  è¯­ä¹‰èšç±»ï¼ˆSemantic Clusteringï¼‰**  
  åŸºäºç”¨æˆ·è¾“å…¥çš„å‘é‡è¡¨ç¤ºï¼Œå°†ç›¸ä¼¼çš„è®°å¿†è‡ªåŠ¨èšåˆæˆç°‡ï¼Œæ”¯æŒ Annoy å¿«é€Ÿç´¢å¼•ï¼Œå¤§å¹…æå‡å¤§è§„æ¨¡è®°å¿†ä¸‹çš„æ£€ç´¢æ•ˆç‡ã€‚

- **ğŸ”— è”æƒ³å›¾ï¼ˆWaypointï¼‰**  
  åœ¨è®°å¿†ä¹‹é—´å»ºç«‹æœ‰å‘è¾¹ï¼Œé€šè¿‡å…±ç°ã€è¯­ä¹‰ç›¸ä¼¼åº¦ç­‰æ–¹å¼æ„å»ºè”æƒ³å…³ç³»ï¼Œæ”¯æŒå¤šè·³æ‰©æ•£æ£€ç´¢ï¼Œè®© AI èƒ½å¤Ÿâ€œæƒ³èµ·â€é—´æ¥ç›¸å…³çš„ä¿¡æ¯ã€‚

- **ğŸ“Š åˆ†å±‚æœç´¢ï¼ˆLayered Searchï¼‰**  
  å°†ç›¸ä¼¼åº¦åˆ’åˆ†ä¸ºå¤šä¸ªåŒºé—´ï¼Œç»“åˆçƒ­åŠ›æƒé‡ã€è®¿é—®é¢‘ç‡å’Œæ–°é²œåº¦å¥–åŠ±ï¼Œä»ä¸åŒå±‚æ¬¡è¿”å›ç»“æœï¼Œå…¼é¡¾ç›¸å…³æ€§ä¸å¤šæ ·æ€§ã€‚

- **ğŸ”„ åŸå­äº‹å®å­˜å‚¨ä¸åŸå§‹å¯¹è¯èšåˆ**  
  å°†å¯¹è¯æ‹†è§£ä¸ºåŸå­äº‹å®ç‹¬ç«‹å­˜å‚¨ï¼Œé€šè¿‡ `parent_turn` å…³è”å›åŸå§‹å¯¹è¯ï¼Œæ—¢ä¿ç•™äº†ç»†èŠ‚åˆä¾¿äºæº¯æºã€‚

- **ğŸ“œ å†å²è®°å½•ç®¡ç†å™¨**  
  åŸºäºè½®æ¬¡ï¼ˆturnï¼‰è®°å½•æ‰€æœ‰åŸå§‹å¯¹è¯ï¼Œæ”¯æŒæŒ‰è½®æ¬¡ã€èŒƒå›´ã€å…³é”®è¯æ£€ç´¢ï¼Œå¹¶æä¾› LRU ç¼“å­˜ä¸ç£ç›˜æŒä¹…åŒ–ã€‚

- **âœ… äº‹åŠ¡ä¸ä¸€è‡´æ€§ä¿è¯**  
  æä¾› STRONG / IMMEDIATE / EVENTUAL ä¸‰ç§ä¸€è‡´æ€§çº§åˆ«ï¼Œç¡®ä¿çƒ­åŠ›ã€ç°‡ã€è®°å¿†ä¹‹é—´çš„æ•°æ®ä¸€è‡´æ€§ã€‚

- **âš¡ å¤šçº§ç¼“å­˜ä¼˜åŒ–**  
  å‘é‡ç¼“å­˜ã€ç›¸ä¼¼åº¦ç¼“å­˜ã€æƒé‡ç¼“å­˜ã€ç°‡æœç´¢ç¼“å­˜ï¼Œå¤§å¹…å‡å°‘é‡å¤è®¡ç®—ï¼Œæå‡å“åº”é€Ÿåº¦ã€‚

- **ğŸ› ï¸ å®Œå–„çš„é…ç½®ç³»ç»Ÿ**  
  æ‰€æœ‰å‚æ•°å‡å¯é€šè¿‡ `Config` ç±»è°ƒæ•´ï¼Œé€‚åº”ä¸åŒè§„æ¨¡çš„åº”ç”¨åœºæ™¯ã€‚

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å®‰è£…

```bash
git clone https://github.com/yourname/heat-mem.git
cd heat-mem
pip install -r requirements.txt
```

**ä¾èµ–**ï¼š  
- Python â‰¥ 3.8  
- numpy  
- annoy
- sentence-transformers

### 2. åˆå§‹åŒ–è®°å¿†æ¨¡å—

```python
from heat_mem.core import MemoryModule

# ä½¿ç”¨é»˜è®¤é…ç½®
mem = MemoryModule()

# æˆ–è€…ä¼ å…¥è‡ªå®šä¹‰çš„åµŒå…¥å‡½æ•°
def my_embedding(text: str) -> np.ndarray:
    # ä½¿ç”¨ä½ è‡ªå·±çš„æ¨¡å‹ç”Ÿæˆå‘é‡
    return ...

mem = MemoryModule(embedding_func=my_embedding)
```

### 3. æ·»åŠ è®°å¿†

```python
# æ·»åŠ ä¸€æ¬¡å¯¹è¯ï¼ˆåŸå­äº‹å®ä¼šè¢«è‡ªåŠ¨æå–ï¼Œä½ éœ€è¦è‡ªè¡Œå®ç°æå–é€»è¾‘ï¼‰
memory_id = mem.add_memory(
    user_input="ä½ å–œæ¬¢ä»€ä¹ˆé¢œè‰²ï¼Ÿ",
    ai_response="æˆ‘å–œæ¬¢è“è‰²ï¼Œåƒå¤§æµ·ä¸€æ ·ã€‚",
    metadata={"session_id": "123"}
)

# æˆ–è€…ç›´æ¥å­˜å‚¨å¤šä¸ªåŸå­äº‹å®
facts = ["Moriå–œæ¬¢è“è‰²", "è“è‰²è®©äººè”æƒ³åˆ°å¤§æµ·"]
mem.add_atomic_memories(
    facts=facts,
    user_input="ä½ å–œæ¬¢ä»€ä¹ˆé¢œè‰²ï¼Ÿ",
    ai_response="æˆ‘å–œæ¬¢è“è‰²ï¼Œåƒå¤§æµ·ä¸€æ ·ã€‚",
    metadata={"turn": 42}
)
```

### 4. æœç´¢è®°å¿†

```python
# åŸºæœ¬ç›¸ä¼¼åº¦æœç´¢
results = mem.search_similar_memories(
    query_text="æµ·æ´‹çš„é¢œè‰²",
    max_results=5
)
for r in results:
    print(f"{r.memory.summary} (å¾—åˆ†: {r.final_score:.3f})")

# åˆ†å±‚æœç´¢ï¼ˆè·å¾—æ›´å¤šæ ·åŒ–çš„ç»“æœï¼‰
layered = mem.get_layered_search_results(
    query_text="æµ·æ´‹çš„é¢œè‰²",
    flatten_results=True
)

# æœç´¢åŸå§‹å¯¹è¯ï¼ˆèšåˆåŸå­äº‹å® + è”æƒ³æ‰©æ•£ï¼‰
originals = mem.search_original_memories(
    query_text="æµ·æ´‹çš„é¢œè‰²",
    max_results=5
)
for orig_mem, score in originals:
    print(f"[è½®æ¬¡ {orig_mem.created_turn}] ç”¨æˆ·: {orig_mem.user_input}")
```

### 5. æ‰‹åŠ¨è§¦å‘è”æƒ³ï¼ˆWaypointï¼‰

```python
# è®°å½•ä¸€è½®å¯¹è¯ä¸­å‡ºç°çš„æ‰€æœ‰è®°å¿†IDï¼ˆç”¨äºå»ºç«‹å…±ç°è¾¹ï¼‰
mem.record_turn_memories([mem_id1, mem_id2, mem_id3])

# è·å–è”æƒ³å›¾ç»Ÿè®¡
print(mem.get_waypoint_stats())
```

---

## âš™ï¸ é…ç½®è¯´æ˜

æ‰€æœ‰é…ç½®é¡¹å‡ä½äº `heat_mem/config.py` çš„ `Config` ç±»ä¸­ã€‚ä½ å¯ä»¥é€šè¿‡ä¿®æ”¹è¯¥æ–‡ä»¶æˆ–å®ä¾‹åŒ–æ—¶ä¼ å…¥è‡ªå®šä¹‰é…ç½®å¯¹è±¡æ¥è°ƒæ•´ç³»ç»Ÿè¡Œä¸ºã€‚

å…³é”®é…ç½®ç¤ºä¾‹ï¼š

```python
from heat_mem.config import Config

config = Config()
config.TOTAL_HEAT = 20_000_000          # æ€»çƒ­åŠ›æ± å¤§å°
config.CLUSTER_SIMILARITY_THRESHOLD = 0.85  # ç°‡ç›¸ä¼¼åº¦é˜ˆå€¼
config.WAYPOINT_MAX_HOPS = 2            # è”æƒ³æœ€å¤§æ·±åº¦
config.LAYERED_SEARCH_MAX_TOTAL_RESULTS = 10

mem = MemoryModule(config=config)
```

è¯¦ç»†é…ç½®é¡¹è¯·å‚è§ [config.py](heat_mem/config.py)ã€‚

---

## ğŸ“– API æ¦‚è§ˆ

| æ–¹æ³• | æè¿° |
|------|------|
| `add_memory(user_input, ai_response, metadata)` | æ·»åŠ ä¸€æ¬¡å®Œæ•´å¯¹è¯ï¼Œè‡ªåŠ¨æå–åŸå­äº‹å®ï¼ˆéœ€è‡ªè¡Œå®ç°æå–é€»è¾‘ï¼‰ |
| `add_atomic_memories(facts, user_input, ai_response, metadata)` | ç›´æ¥å­˜å‚¨åŸå­äº‹å®åˆ—è¡¨ï¼Œå¤„ç†é‡å¤æ£€æµ‹ä¸åˆå¹¶ |
| `search_similar_memories(query_text/vector, max_results)` | åŸºç¡€ç›¸ä¼¼åº¦æœç´¢ |
| `search_layered_memories(...)` | åˆ†å±‚æœç´¢ï¼Œè¿”å›å„å±‚ç»“æœ |
| `get_layered_search_results(...)` | è·å–æ‰å¹³åŒ–çš„åˆ†å±‚æœç´¢ç»“æœ |
| `search_original_memories(...)` | èšåˆåŸå­äº‹å®è¿”å›åŸå§‹å¯¹è¯ï¼Œå¹¶åˆ©ç”¨è”æƒ³å›¾æ‰©æ•£ |
| `search_within_cluster(cluster_id, ...)` | åœ¨æŒ‡å®šç°‡å†…æœç´¢ |
| `find_best_clusters_for_query(query, top_k)` | æŸ¥æ‰¾ä¸æŸ¥è¯¢æœ€åŒ¹é…çš„ç°‡ |
| `access_memory(memory_id)` | è®¿é—®ä¸€æ¡è®°å¿†ï¼ˆå¢åŠ è®¿é—®è®¡æ•°ã€æ›´æ–°çƒ­åŠ›ï¼‰ |
| `record_turn_memories(memory_ids)` | è®°å½•ä¸€è½®å¯¹è¯ä¸­å‡ºç°çš„æ‰€æœ‰è®°å¿†IDï¼Œç”¨äºå»ºç«‹å…±ç°è¾¹ |
| `reinforce_waypoint_edges(seed_ids, hit_ids)` | å¼ºåŒ–ç§å­åˆ°æ‰©æ•£å‘½ä¸­çš„è¾¹ |
| `get_stats()` | è·å–ç³»ç»Ÿç»Ÿè®¡ä¿¡æ¯ï¼ˆçƒ­åŠ›ã€ç¼“å­˜å‘½ä¸­ç‡ã€è”æƒ³å›¾è§„æ¨¡ç­‰ï¼‰ |
| `cleanup()` | å…³é—­èµ„æºï¼Œä¿å­˜çŠ¶æ€ |

æ›´å¤šæ–¹æ³•è¯·å‚è€ƒ [core.py](heat_mem/core.py) ä¸­çš„ `MemoryModule` ç±»ã€‚

---

## ğŸ—ï¸ æ¶æ„æ¦‚è§ˆ

```
memory_system/
â”œâ”€â”€ core.py                 # æ ¸å¿ƒ MemoryModule ä¸äº‹åŠ¡ä¸Šä¸‹æ–‡
â”œâ”€â”€ models.py               # æ•°æ®ç±»ï¼ˆMemoryItem, SemanticCluster, WaypointEdge...ï¼‰
â”œâ”€â”€ config.py               # å…¨å±€é…ç½®
â”œâ”€â”€ utils.py                # å·¥å…·å‡½æ•°ï¼ˆå‘é‡è½¬æ¢ã€ç›¸ä¼¼åº¦è®¡ç®—ç­‰ï¼‰
â”œâ”€â”€ infrastructure/
â”‚   â”œâ”€â”€ database.py         # æ•°æ®åº“è¿æ¥ä¸åˆå§‹åŒ–
â”‚   â”œâ”€â”€ cache.py            # å¤šçº§ç¼“å­˜ç®¡ç†
â”‚   â”œâ”€â”€ locking.py          # åˆ†å¸ƒå¼é”ï¼ˆçº¿ç¨‹çº§ï¼‰
â”‚   â””â”€â”€ history.py          # å†å²è®°å½•ç®¡ç†å™¨
â””â”€â”€ services/
    â”œâ”€â”€ heat_system.py      # çƒ­åŠ›åˆ†é…ã€å›æ”¶ã€æš‚å­˜çƒ­åŠ›å¤„ç†
    â”œâ”€â”€ cluster_service.py  # è¯­ä¹‰ç°‡ç®¡ç†ã€Annoyç´¢å¼•
    â”œâ”€â”€ search_service.py   # æœç´¢é€»è¾‘ï¼ˆåˆ†å±‚ã€ç°‡å†…ã€åŸå§‹å¯¹è¯è”æƒ³ï¼‰
    â””â”€â”€ waypoint.py         # è”æƒ³å›¾æœåŠ¡
```

---

## ğŸ¤ è´¡çŒ®æŒ‡å—

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼  
åœ¨å¼€å‘å‰è¯·ç¡®ä¿ï¼š

- ä»£ç é€šè¿‡ `pylint` æˆ– `flake8` æ£€æŸ¥  
- æ–°å¢åŠŸèƒ½åŒ…å«å¿…è¦çš„å•å…ƒæµ‹è¯•ï¼ˆä½äº `tests/`ï¼‰  
- æ›´æ–°ç›¸å…³æ–‡æ¡£  

---

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®åŸºäº MIT è®¸å¯è¯å¼€æºï¼Œè¯¦æƒ…è¯·è§ [LICENSE](LICENSE) æ–‡ä»¶ã€‚

---

## ğŸŒŸ è‡´è°¢

Heat Mem çš„è®¾è®¡å—åˆ°äººç±»è®°å¿†æœºåˆ¶çš„å¯å‘ï¼Œå¹¶å€Ÿé‰´äº†å¤šç¯‡å…³äºè®°å¿†ç½‘ç»œå’Œçƒ­åŠ›ç³»ç»Ÿçš„ç ”ç©¶è®ºæ–‡ã€‚ç‰¹åˆ«æ„Ÿè°¢æ‰€æœ‰è´¡çŒ®è€…å’Œæµ‹è¯•è€…ã€‚

---

**è®© Mori è®°ä½æ¯ä¸€æ¬¡å¯¹è¯ï¼Œæˆä¸ºæ›´æ‡‚ä½ çš„ AIã€‚**
